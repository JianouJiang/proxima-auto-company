<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Your First Connection — SixDegrees</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", sans-serif, "Noto Sans CJK SC", "Noto Sans";
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="sticky top-0 bg-white shadow-sm z-40 px-4 md:px-6 py-4">
        <div class="flex items-center justify-between max-w-4xl mx-auto">
            <a href="/public/index.html" class="text-2xl font-bold text-blue-600">
                <span data-en="SixDegrees" data-zh="六度人脉">SixDegrees</span>
            </a>
            <div class="flex items-center gap-4">
                <button id="lang-en" class="px-3 py-1 text-sm font-semibold text-blue-600 border-b-2 border-blue-600">EN</button>
                <button id="lang-zh" class="px-3 py-1 text-sm font-semibold text-gray-400 border-b-2 border-transparent hover:text-gray-600">中文</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="min-h-screen px-4 md:px-6 py-12">
        <div class="max-w-2xl mx-auto">
            <!-- Form Card -->
            <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    <span data-en="Start Your First Connection" data-zh="开始你的第一次联系">Start Your First Connection</span>
                </h1>
                <p class="text-gray-600 mb-8">
                    <span data-en="Tell us who you want to reach. Our AI will find the path." data-zh="告诉我们你想联系谁。我们的AI将找到路径。">
                        Tell us who you want to reach. Our AI will find the path.
                    </span>
                </p>

                <form id="intake-form" class="space-y-6">
                    <!-- User Name -->
                    <div>
                        <label for="user-name" class="block text-sm font-semibold text-gray-900 mb-2">
                            <span data-en="Your Name" data-zh="你的姓名">Your Name</span>
                            <span class="text-red-600">*</span>
                        </label>
                        <input
                            type="text"
                            id="user-name"
                            name="user-name"
                            required
                            maxlength="50"
                            class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors"
                            data-placeholder-en="Sarah Chen"
                            data-placeholder-zh="张三"
                            placeholder="Sarah Chen"
                        />
                        <p class="mt-1 text-xs text-gray-500">
                            <span data-en="How should we address you?" data-zh="我们应该如何称呼你？">How should we address you?</span>
                        </p>
                    </div>

                    <!-- User Email -->
                    <div>
                        <label for="user-email" class="block text-sm font-semibold text-gray-900 mb-2">
                            <span data-en="Your Email" data-zh="你的电子邮件">Your Email</span>
                            <span class="text-red-600">*</span>
                        </label>
                        <input
                            type="email"
                            id="user-email"
                            name="user-email"
                            required
                            class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors"
                            data-placeholder-en="sarah@company.com"
                            data-placeholder-zh="zhangsan@company.com"
                            placeholder="sarah@company.com"
                        />
                        <p class="mt-1 text-xs text-gray-500">
                            <span data-en="We'll send campaign updates here" data-zh="我们会将活动更新发送到这里">We'll send campaign updates here</span>
                        </p>
                    </div>

                    <!-- User Background -->
                    <div>
                        <label for="user-background" class="block text-sm font-semibold text-gray-900 mb-2">
                            <span data-en="Quick Intro to Yourself (100 words)" data-zh="简单介绍一下自己（100字）">Quick Intro to Yourself (100 words)</span>
                            <span class="text-red-600">*</span>
                        </label>
                        <textarea
                            id="user-background"
                            name="user-background"
                            required
                            rows="4"
                            maxlength="500"
                            class="w-full px-4 py-3 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors resize-none"
                            data-placeholder-en="I'm founder of X. We're solving Y problem..."
                            data-placeholder-zh="我是X公司的创始人。我们正在解决Y问题..."
                            placeholder="I'm founder of X. We're solving Y problem..."
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 flex justify-between">
                            <span data-en="Brief context about who you are" data-zh="简要介绍你是谁">Brief context about who you are</span>
                            <span id="background-count" class="text-gray-400">0/500</span>
                        </p>
                    </div>

                    <!-- Target Name -->
                    <div>
                        <label for="target-name" class="block text-sm font-semibold text-gray-900 mb-2">
                            <span data-en="Who do you want to reach?" data-zh="你想联系谁？">Who do you want to reach?</span>
                            <span class="text-red-600">*</span>
                        </label>
                        <input
                            type="text"
                            id="target-name"
                            name="target-name"
                            required
                            maxlength="100"
                            class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors"
                            data-placeholder-en="Elon Musk"
                            data-placeholder-zh="埃隆·马斯克"
                            placeholder="Elon Musk"
                        />
                    </div>

                    <!-- Target Title/Company -->
                    <div>
                        <label for="target-company" class="block text-sm font-semibold text-gray-900 mb-2">
                            <span data-en="Their Title / Company" data-zh="他们的职位/公司">Their Title / Company</span>
                            <span class="text-red-600">*</span>
                        </label>
                        <input
                            type="text"
                            id="target-company"
                            name="target-company"
                            required
                            maxlength="100"
                            class="w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors"
                            data-placeholder-en="CEO, Tesla"
                            data-placeholder-zh="CEO, 特斯拉"
                            placeholder="CEO, Tesla"
                        />
                    </div>

                    <!-- Target Reason -->
                    <div>
                        <label for="target-reason" class="block text-sm font-semibold text-gray-900 mb-2">
                            <span data-en="Why do you need to reach them?" data-zh="你为什么需要联系他们？">Why do you need to reach them?</span>
                            <span class="text-red-600">*</span>
                        </label>
                        <textarea
                            id="target-reason"
                            name="target-reason"
                            required
                            rows="5"
                            maxlength="500"
                            class="w-full px-4 py-3 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors resize-none"
                            data-placeholder-en="Want to discuss energy storage for EVs..."
                            data-placeholder-zh="想讨论电动汽车的能源存储..."
                            placeholder="Want to discuss energy storage for EVs..."
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 flex justify-between">
                            <span data-en="Tell the story — this helps AI personalize outreach" data-zh="讲述故事——这有助于AI个性化联系">Tell the story — this helps AI personalize outreach</span>
                            <span id="reason-count" class="text-gray-400">0/500</span>
                        </p>
                    </div>

                    <!-- Progress Indicator -->
                    <div class="bg-gray-100 rounded p-4">
                        <div class="flex items-center justify-between text-sm mb-2">
                            <span class="font-semibold text-gray-700">
                                <span data-en="Form Progress" data-zh="表单进度">Form Progress</span>
                            </span>
                            <span id="progress-text" class="text-gray-500">0/6 fields</span>
                        </div>
                        <div class="w-full bg-gray-300 rounded-full h-2">
                            <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        id="submit-btn"
                        disabled
                        class="w-full px-8 py-4 rounded bg-gray-300 text-gray-500 font-bold text-lg cursor-not-allowed transition-all disabled:opacity-50"
                    >
                        <span data-en="Let AI Research & Plan" data-zh="让AI研究和规划">Let AI Research & Plan</span>
                    </button>

                    <!-- Loading State (hidden initially) -->
                    <div id="loading-state" class="hidden text-center py-8">
                        <div class="inline-block animate-spin text-4xl text-blue-600 mb-4">⟳</div>
                        <p class="text-lg font-semibold text-gray-700">
                            <span data-en="Analyzing your request..." data-zh="正在分析你的请求...">Analyzing your request...</span>
                        </p>
                        <p class="text-sm text-gray-500 mt-2">
                            <span data-en="This usually takes 10-30 seconds" data-zh="这通常需要10-30秒">This usually takes 10-30 seconds</span>
                        </p>
                    </div>

                    <!-- Error State (hidden initially) -->
                    <div id="error-state" class="hidden bg-red-50 border border-red-200 rounded p-4 text-center">
                        <p class="text-red-700 font-semibold mb-2">
                            <span data-en="Something went wrong" data-zh="出了点问题">Something went wrong</span>
                        </p>
                        <p id="error-message" class="text-sm text-red-600 mb-4"></p>
                        <button type="button" onclick="location.reload()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                            <span data-en="Try Again" data-zh="重试">Try Again</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Info Section -->
            <div class="mt-8 text-center text-sm text-gray-500">
                <p>
                    <span data-en="Your data is secure and never shared without permission." data-zh="你的数据是安全的，未经许可不会共享。">
                        Your data is secure and never shared without permission.
                    </span>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Language management
        let currentLang = 'en';

        document.getElementById('lang-en').addEventListener('click', () => {
            currentLang = 'en';
            updateLanguage();
            updateLanguageButtons();
        });

        document.getElementById('lang-zh').addEventListener('click', () => {
            currentLang = 'zh';
            updateLanguage();
            updateLanguageButtons();
        });

        function updateLanguage() {
            // Update all text elements
            document.querySelectorAll('[data-en]').forEach(el => {
                const text = currentLang === 'en' ? el.getAttribute('data-en') : el.getAttribute('data-zh');
                if (text) el.textContent = text;
            });

            // Update all placeholders
            document.querySelectorAll('[data-placeholder-en]').forEach(el => {
                const placeholder = currentLang === 'en' ? el.getAttribute('data-placeholder-en') : el.getAttribute('data-placeholder-zh');
                if (placeholder) el.placeholder = placeholder;
            });

            localStorage.setItem('sixdegrees_language', currentLang);
        }

        function updateLanguageButtons() {
            const enBtn = document.getElementById('lang-en');
            const zhBtn = document.getElementById('lang-zh');

            if (currentLang === 'en') {
                enBtn.classList.add('text-blue-600', 'border-blue-600');
                enBtn.classList.remove('text-gray-400', 'border-transparent');
                zhBtn.classList.remove('text-blue-600', 'border-blue-600');
                zhBtn.classList.add('text-gray-400', 'border-transparent');
            } else {
                zhBtn.classList.add('text-blue-600', 'border-blue-600');
                zhBtn.classList.remove('text-gray-400', 'border-transparent');
                enBtn.classList.remove('text-blue-600', 'border-blue-600');
                enBtn.classList.add('text-gray-400', 'border-transparent');
            }
        }

        // Restore saved language
        const savedLang = localStorage.getItem('sixdegrees_language');
        if (savedLang === 'zh') {
            currentLang = 'zh';
            updateLanguage();
            updateLanguageButtons();
        }

        // Form validation and progress tracking
        const form = document.getElementById('intake-form');
        const submitBtn = document.getElementById('submit-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const fields = ['user-name', 'user-email', 'user-background', 'target-name', 'target-company', 'target-reason'];

        // Character counters
        document.getElementById('user-background').addEventListener('input', (e) => {
            document.getElementById('background-count').textContent = `${e.target.value.length}/500`;
            updateProgress();
        });

        document.getElementById('target-reason').addEventListener('input', (e) => {
            document.getElementById('reason-count').textContent = `${e.target.value.length}/500`;
            updateProgress();
        });

        // Update progress on all field changes
        fields.forEach(fieldId => {
            document.getElementById(fieldId).addEventListener('input', updateProgress);
        });

        function updateProgress() {
            let filledFields = 0;
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field.value.trim().length > 0) {
                    filledFields++;
                }
            });

            const progress = (filledFields / fields.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${filledFields}/${fields.length} fields`;

            // Enable submit button when all fields filled
            if (filledFields === fields.length) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                submitBtn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700', 'cursor-pointer');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                submitBtn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700', 'cursor-pointer');
            }
        }

        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Hide form, show loading
            form.classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');

            // Collect form data
            const formData = {
                user_email: document.getElementById('user-email').value.trim(),
                user_name: document.getElementById('user-name').value.trim(),
                target_name: document.getElementById('target-name').value.trim(),
                target_company: document.getElementById('target-company').value.trim(),
                target_reason: document.getElementById('target-reason').value.trim(),
                user_background: document.getElementById('user-background').value.trim(),
            };

            try {
                // Submit to API
                const response = await fetch('/api/intake', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.success && result.campaign_id) {
                    // Success — redirect to dashboard with campaign ID
                    window.location.href = `/dashboard.html?campaign=${result.campaign_id}`;
                } else {
                    throw new Error(result.error || 'Campaign creation failed');
                }
            } catch (error) {
                // Show error state
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message || 'Network error. Please try again.';
            }
        });
    </script>
</body>
</html>
